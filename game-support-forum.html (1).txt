<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Support Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --orange-main: #ff6b35;
            --red-hot: #e63946;
            --yellow-fresh: #ffb703;
            --green-herb: #52b788;
            --cream-bg: #fff8f0;
            --warm-beige: #fef6e4;
            --card-bg: #ffffff;
            --text-primary: #2b2d42;
            --text-secondary: #5a5f73;
            --border-color: #ffb703;
            --accent-glow: rgba(255, 107, 53, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, var(--cream-bg) 0%, var(--warm-beige) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 53, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(255, 183, 3, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 40px;
            position: relative;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--orange-main), var(--red-hot), var(--yellow-fresh));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 10px;
            animation: glowPulse 3s ease-in-out infinite;
            filter: drop-shadow(2px 2px 4px rgba(255, 107, 53, 0.3));
        }

        @keyframes glowPulse {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 40px;
        }

        .new-query-section {
            background: var(--card-bg);
            border: 3px solid var(--orange-main);
            border-radius: 16px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.15);
        }

        .new-query-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--orange-main), var(--yellow-fresh), var(--orange-main));
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--orange-main);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        input, textarea, select {
            width: 100%;
            background: var(--warm-beige);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--orange-main);
            box-shadow: 0 0 0 3px var(--accent-glow);
            background: var(--card-bg);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: linear-gradient(135deg, var(--orange-main), var(--red-hot));
            color: white;
            border: none;
            padding: 14px 32px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 107, 53, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .stats-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 3px solid var(--yellow-fresh);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 183, 3, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--red-hot);
        }

        .stat-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            color: var(--orange-main);
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(255, 107, 53, 0.2);
        }

        .stat-label {
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .categories {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .category-tag {
            background: var(--warm-beige);
            border: 2px solid var(--yellow-fresh);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .category-tag:hover, .category-tag.active {
            background: var(--orange-main);
            color: white;
            border-color: var(--orange-main);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 107, 53, 0.3);
        }

        .queries-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .query-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-left: 5px solid var(--orange-main);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .query-card:hover {
            border-color: var(--orange-main);
            transform: translateX(5px);
            box-shadow: -5px 5px 25px rgba(255, 107, 53, 0.2);
        }

        .query-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .query-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: var(--red-hot);
            margin-bottom: 8px;
        }

        .query-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .query-category {
            background: linear-gradient(135deg, var(--green-herb), #40916c);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .query-content {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .query-status {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-open {
            background: rgba(255, 183, 3, 0.2);
            color: #d4860f;
            border: 2px solid var(--yellow-fresh);
        }

        .status-resolved {
            background: rgba(82, 183, 136, 0.2);
            color: var(--green-herb);
            border: 2px solid var(--green-herb);
        }

        .replies-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .reply {
            background: var(--warm-beige);
            border-left: 4px solid var(--green-herb);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .reply-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .reply-author {
            color: var(--orange-main);
            font-weight: 600;
        }

        .reply-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .reply-form {
            margin-top: 15px;
        }

        .btn-secondary {
            background: var(--warm-beige);
            color: var(--text-primary);
            border: 2px solid var(--yellow-fresh);
            padding: 10px 20px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: var(--yellow-fresh);
            color: var(--text-primary);
            border-color: var(--yellow-fresh);
            box-shadow: 0 2px 10px rgba(255, 183, 3, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .stats-sidebar {
                flex-direction: row;
            }

            h1 {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 640px) {
            h1 {
                font-size: 2rem;
            }

            .stat-number {
                font-size: 2rem;
            }

            .stats-sidebar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üç≥ Kitchen Scramble Support üç≥</h1>
            <p class="subtitle">Chef Pepper's Help Kitchen</p>
        </header>

        <div class="main-grid">
            <div class="new-query-section">
                <h2 class="section-title">Submit New Query</h2>
                <form id="queryForm">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" required placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" required>
                            <option value="">Select a category</option>
                            <option value="Bug Report">Bug Report</option>
                            <option value="Gameplay">Gameplay</option>
                            <option value="Technical">Technical</option>
                            <option value="Account">Account</option>
                            <option value="Feature Request">Feature Request</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" id="title" required placeholder="Brief description of your issue">
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" required placeholder="Provide detailed information about your query..."></textarea>
                    </div>
                    <button type="submit" class="btn">Submit Query</button>
                </form>
            </div>

            <div class="stats-sidebar">
                <div class="stat-card">
                    <div class="stat-number" id="totalQueries">0</div>
                    <div class="stat-label">Total Queries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="openQueries">0</div>
                    <div class="stat-label">Open</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="resolvedQueries">0</div>
                    <div class="stat-label">Resolved</div>
                </div>
            </div>
        </div>

        <div class="categories" id="categoryFilters">
            <div class="category-tag active" data-category="all">All</div>
            <div class="category-tag" data-category="Bug Report">Bug Report</div>
            <div class="category-tag" data-category="Gameplay">Gameplay</div>
            <div class="category-tag" data-category="Technical">Technical</div>
            <div class="category-tag" data-category="Account">Account</div>
            <div class="category-tag" data-category="Feature Request">Feature Request</div>
            <div class="category-tag" data-category="Other">Other</div>
        </div>

        <div class="queries-list" id="queriesList">
            <div class="empty-state">
                <div class="empty-state-icon">üéÆ</div>
                <h3>No queries yet</h3>
                <p>Be the first to submit a support query!</p>
            </div>
        </div>

        <!-- Admin Setup Guide -->
        <div style="margin-top: 50px; padding: 30px; background: var(--card-bg); border: 3px solid var(--green-herb); border-radius: 16px; box-shadow: 0 4px 20px rgba(82, 183, 136, 0.2);">
            <h2 style="color: var(--orange-main); font-family: 'Orbitron', sans-serif; margin-bottom: 20px; font-size: 1.8rem;">üõ†Ô∏è Admin Setup Guide</h2>
            
            <div style="background: var(--warm-beige); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="color: var(--red-hot); margin-bottom: 15px; font-size: 1.3rem;">üìã How to Grant Admin Access:</h3>
                <ol style="line-height: 1.8; color: var(--text-primary); margin-left: 20px;">
                    <li><strong>Open the HTML file</strong> in a text editor (Notepad, VS Code, etc.)</li>
                    <li><strong>Find the ADMIN_USERS array</strong> (around line 390)</li>
                    <li><strong>Add Discord usernames</strong> to the array:
                        <pre style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid var(--orange-main); overflow-x: auto;">const ADMIN_USERS = [
    'admin',
    'moderator',
    'YourDiscordName',    // Add your Discord username here
    'FriendName',         // Add more admins here
];</pre>
                    </li>
                    <li><strong>Save the file</strong> and refresh the page</li>
                </ol>
            </div>

            <div style="background: var(--warm-beige); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="color: var(--red-hot); margin-bottom: 15px; font-size: 1.3rem;">üíæ Where Data is Stored:</h3>
                <ul style="line-height: 1.8; color: var(--text-primary); margin-left: 20px;">
                    <li><strong>Browser Storage:</strong> All queries are saved in your browser's persistent storage</li>
                    <li><strong>Shared Access:</strong> Data is shared across all users who access this page</li>
                    <li><strong>Export Data:</strong> Open browser console (F12) and type:
                        <pre style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid var(--orange-main); overflow-x: auto;">// View all queries
console.log(queries);

// Export to JSON
console.log(JSON.stringify(queries, null, 2));</pre>
                    </li>
                </ul>
            </div>

            <div style="background: var(--warm-beige); padding: 20px; border-radius: 12px;">
                <h3 style="color: var(--red-hot); margin-bottom: 15px; font-size: 1.3rem;">üéÆ Discord Integration Tips:</h3>
                <ul style="line-height: 1.8; color: var(--text-primary); margin-left: 20px;">
                    <li><strong>Share Link:</strong> Host this HTML file on GitHub Pages, Netlify, or your web server</li>
                    <li><strong>Pin in Channel:</strong> Pin the support page link in your Discord support channel</li>
                    <li><strong>Bot Integration:</strong> Use Discord webhook to notify when new queries are submitted</li>
                    <li><strong>Permissions:</strong> Only users with usernames in ADMIN_USERS can reply and mark resolved</li>
                    <li><strong>User Names:</strong> Players can use their Discord usernames when submitting queries</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let queries = [];
        let currentFilter = 'all';
        let expandedQuery = null;
        let currentUser = {
            username: '',
            role: 'player' // 'player' or 'admin'
        };

        // Admin usernames - add Discord usernames here for admin access
        const ADMIN_USERS = [
            'admin',
            'moderator',
            'chef_support',
            'testingggl_51165',     // Your admin username - CORRECTED!
            // Add more Discord usernames here, e.g.:
            // 'YourDiscordName#1234',
        ];

        function checkAdminStatus(username) {
            return ADMIN_USERS.includes(username.toLowerCase());
        }

        async function loadQueries() {
            try {
                const keys = await window.storage.list('query:');
                if (keys && keys.keys) {
                    const loadedQueries = [];
                    for (const key of keys.keys) {
                        try {
                            const result = await window.storage.get(key);
                            if (result && result.value) {
                                loadedQueries.push(JSON.parse(result.value));
                            }
                        } catch (e) {
                            console.log('Query not found:', key);
                        }
                    }
                    queries = loadedQueries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                }
            } catch (error) {
                console.log('Starting with empty queries');
                queries = [];
            }
            updateUI();
        }

        async function saveQuery(query) {
            try {
                await window.storage.set(`query:${query.id}`, JSON.stringify(query));
            } catch (error) {
                console.error('Error saving query:', error);
            }
        }

        document.getElementById('queryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            
            // Set current user and check admin status
            currentUser.username = username;
            currentUser.role = checkAdminStatus(username) ? 'admin' : 'player';
            
            const query = {
                id: Date.now().toString(),
                username: username,
                category: document.getElementById('category').value,
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                timestamp: new Date().toISOString(),
                status: 'open',
                replies: []
            };

            queries.unshift(query);
            await saveQuery(query);
            
            document.getElementById('queryForm').reset();
            updateUI();
            
            // Show admin status
            if (currentUser.role === 'admin') {
                alert('üéñÔ∏è Admin access granted! You can now reply to queries and mark them as resolved.');
            }
        });

        document.getElementById('categoryFilters').addEventListener('click', (e) => {
            if (e.target.classList.contains('category-tag')) {
                document.querySelectorAll('.category-tag').forEach(tag => tag.classList.remove('active'));
                e.target.classList.add('active');
                currentFilter = e.target.dataset.category;
                updateUI();
            }
        });

        function updateUI() {
            updateStats();
            renderQueries();
        }

        function updateStats() {
            const total = queries.length;
            const open = queries.filter(q => q.status === 'open').length;
            const resolved = queries.filter(q => q.status === 'resolved').length;

            document.getElementById('totalQueries').textContent = total;
            document.getElementById('openQueries').textContent = open;
            document.getElementById('resolvedQueries').textContent = resolved;
        }

        function renderQueries() {
            const container = document.getElementById('queriesList');
            let filteredQueries = queries;

            if (currentFilter !== 'all') {
                filteredQueries = queries.filter(q => q.category === currentFilter);
            }

            if (filteredQueries.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üéÆ</div>
                        <h3>No queries found</h3>
                        <p>Try selecting a different category or submit a new query!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredQueries.map(query => {
                const isAdmin = currentUser.role === 'admin';
                const canReply = isAdmin;
                const canChangeStatus = isAdmin;
                
                return `
                <div class="query-card" data-id="${query.id}">
                    <div class="query-header">
                        <div>
                            <h3 class="query-title">${escapeHtml(query.title)}</h3>
                            <div class="query-meta">
                                <span>üë§ ${escapeHtml(query.username)}</span>
                                <span>üìÖ ${formatDate(query.timestamp)}</span>
                            </div>
                        </div>
                        <div>
                            <span class="query-category">${query.category}</span>
                        </div>
                    </div>
                    <p class="query-content">${escapeHtml(query.description)}</p>
                    <span class="query-status status-${query.status}">${query.status}</span>
                    
                    <div class="replies-section">
                        <h4 class="section-title" style="font-size: 1.1rem; margin-bottom: 15px;">
                            Replies (${query.replies.length})
                        </h4>
                        ${query.replies.map(reply => `
                            <div class="reply">
                                <div class="reply-header">
                                    <span class="reply-author">${escapeHtml(reply.author)}</span>
                                    <span>${formatDate(reply.timestamp)}</span>
                                </div>
                                <div class="reply-content">${escapeHtml(reply.content)}</div>
                            </div>
                        `).join('')}
                        
                        ${canReply ? `
                        <div class="reply-form">
                            <textarea id="reply-${query.id}" placeholder="Type your reply as ${currentUser.username}..." style="margin-bottom: 10px;"></textarea>
                            <button class="btn" onclick="addReply('${query.id}')">Post Reply</button>
                            ${canChangeStatus ? (
                                query.status === 'open' ? 
                                    `<button class="btn-secondary" onclick="markResolved('${query.id}')">‚úÖ Mark as Resolved</button>` : 
                                    `<button class="btn-secondary" onclick="markOpen('${query.id}')">üîÑ Reopen</button>`
                            ) : ''}
                        </div>
                        ` : `
                        <div style="margin-top: 15px; padding: 15px; background: var(--warm-beige); border-radius: 8px; text-align: center; color: var(--text-secondary);">
                            üîí Only admins can reply to queries. Please wait for support team response.
                        </div>
                        `}
                    </div>
                </div>
            `}).join('');
        }

        async function addReply(queryId) {
            if (currentUser.role !== 'admin') {
                alert('Only admins can reply to queries.');
                return;
            }
            
            const replyText = document.getElementById(`reply-${queryId}`).value.trim();
            if (!replyText) return;

            const query = queries.find(q => q.id === queryId);
            if (!query) return;

            query.replies.push({
                author: currentUser.username,
                content: replyText,
                timestamp: new Date().toISOString()
            });

            await saveQuery(query);
            document.getElementById(`reply-${queryId}`).value = '';
            updateUI();
        }

        async function markResolved(queryId) {
            if (currentUser.role !== 'admin') {
                alert('Only admins can change query status.');
                return;
            }
            const query = queries.find(q => q.id === queryId);
            if (query) {
                query.status = 'resolved';
                await saveQuery(query);
                updateUI();
            }
        }

        async function markOpen(queryId) {
            if (currentUser.role !== 'admin') {
                alert('Only admins can change query status.');
                return;
            }
            const query = queries.find(q => q.id === queryId);
            if (query) {
                query.status = 'open';
                await saveQuery(query);
                updateUI();
            }
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            return date.toLocaleDateString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        loadQueries();
    </script>
</body>
</html>
